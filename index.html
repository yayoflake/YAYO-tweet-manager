<!doctype html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YAYO tweet manager</title>
  <link rel="stylesheet" href="./src/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=block" rel="stylesheet">
</head>

<body>
  <div id="appRoot">
    <!-- 폰트 로딩 텀을 없애기 위한 프리로더: 실제 렌더링을 유도하여 미리 로딩함 -->
    <div
      style="font-family: 'Noto Sans KR'; position: fixed; top: -100px; left: -100px; opacity: 0.01; pointer-events: none;">
      폰트 preload</div>
    <div id="mainArea">
      <div id="panelBackdrop"></div>
      <div id="filterPanelToggle" class="panelToggleBar" title="필터 패널 열기">
        <span class="panelToggleLabel">필터</span>
      </div>
      <div id="rightPanelToggle" class="panelToggleBar" title="선택 패널 열기">
        <span class="panelToggleLabel" id="rightPanelToggleCount">선택</span>
      </div>

      <div id="splitLayout">
        <div id="filterPanel">
          <h2>YAYO tweet manager</h2>

          <div class="row">
            <span class="pill" id="status">불러오는 중...</span>
            <button id="reloadBtn">다시 읽기</button>
          </div>

          <div class="filterSection">
            <div class="filterLabel">검색</div>
            <input id="keyword" type="text" placeholder="키워드 또는 트윗 ID로 검색" />
          </div>

          <div class="filterSection">
            <div class="row" style="gap: 8px; margin-top: 4px;">
              <label class="filterInlineLabel">RT: <input id="minRT" type="number" min="0" step="1" value="0" /></label>
              <label class="filterInlineLabel">마음: <input id="minFav" type="number" min="0" step="1"
                  value="0" /></label>
              <label class="filterInlineLabel">개 이상</label>
            </div>
          </div>
          <details id="advancedBox" open>
            <summary>고급 검색 필터</summary>

            <div class="filterSection">
              <div class="filterLabel">날짜</div>
              <div class="filterDateGroup">
                <label>시작일<input id="dateFrom" type="date" /></label>
                <label>종료일<input id="dateTo" type="date" /></label>
                <label>특정일<input id="dateExact" type="date" /></label>
              </div>
            </div>

            <div class="filterSection">
              <div class="filterLabel">태그</div>
              <div class="filterBtnGroup">
                <label class="pill"><input id="excludeRetweets" type="checkbox" />리트윗 데이터</label>
                <label class="pill"><input id="excludeMentions" type="checkbox" />타인에게 보낸 멘션</label>
                <label class="pill"><input id="filterTagNormal" type="checkbox" checked />일반 트윗</label>
                <label class="pill"><input id="filterTagAnon" type="checkbox" checked />익명 질문</label>
                <label class="pill"><input id="filterTagExternalLink" type="checkbox" checked />외부 링크</label>
                <label class="pill"><input id="filterTagQuoteMine" type="checkbox" checked />내 트윗을 인용</label>
                <label class="pill"><input id="filterTagQuoteOther" type="checkbox" checked />남의 트윗을 인용</label>
              </div>
            </div>

            <div class="filterSection">
              <div class="filterLabel">미디어</div>
              <div class="filterBtnGroup">
                <label class="pill"><input type="radio" name="mediaFilter" id="mediaFilterAll" value="all"
                    checked />전체</label>
                <label class="pill"><input type="radio" name="mediaFilter" id="mediaFilterTextOnly"
                    value="textOnly" />텍스트만</label>
                <label class="pill"><input type="radio" name="mediaFilter" id="mediaFilterHasMedia"
                    value="hasMedia" />미디어
                  포함</label>
                <label class="pill"><input type="radio" name="mediaFilter" id="mediaFilterMediaOnly"
                    value="mediaOnly" />미디어만 (본문 없음)</label>
              </div>
            </div>

            <div class="filterSection">
              <div class="filterLabel">미디어 종류</div>
              <div class="filterBtnGroup">
                <label class="pill"><input id="filterMediaVideo" type="checkbox" checked />동영상+GIF</label>
                <label class="pill"><input id="filterMediaPhoto" type="checkbox" checked />사진</label>
                <label class="pill"><input id="filterMediaYoutube" type="checkbox" checked />유튜브</label>
              </div>
            </div>
          </details>

          <details id="viewBox" open>
            <summary>보기 설정</summary>
            <div class="filterBtnGroup" style="margin-top: 8px;">
              <label class="pill"><input id="showQuotePreview" type="checkbox" checked />인용 미리보기</label>
              <label class="pill"><input id="showReplyPreview" type="checkbox" checked />답글 미리보기</label>
              <label class="pill"><input id="threadGroup" type="checkbox" checked />타래 묶기</label>
            </div>
          </details>

          <div style="margin-top: 12px;">
            <button id="clearBtn" disabled>검색 초기화</button>
          </div>

        </div><!-- #filterPanel -->

        <div id="mainPanel">
          <div class="main-panel-sticky-header">
            <div class="row">
              <button id="selectAllPageBtn" disabled>현재 페이지 전체 선택</button>
              <button id="selectAllFilteredBtn" disabled>검색 결과 전체 선택</button>
              <span class="muted" id="counts"></span>
            </div>

            <div class="row pager">
              <button id="prevPageBtn" disabled>이전</button>
              <span class="pageNum" id="pageInfo">0-0</span>
              <button id="nextPageBtn" disabled>다음</button>
              <label class="muted">
                페이지 이동:
                <select id="pageSelect" disabled></select>
              </label>
            </div>
          </div>

          <div id="error" class="danger" style="margin-top: 10px;"></div>

          <table>
            <thead>
              <tr>
                <th>트윗</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>

          <div class="row pager" style="margin-top: 12px;">
            <button id="prevPageBtnBottom" disabled>이전</button>
            <span class="pageNum" id="pageInfoBottom">0-0</span>
            <button id="nextPageBtnBottom" disabled>다음</button>
            <label class="muted">
              페이지 이동:
              <select id="pageSelectBottom" disabled></select>
            </label>
          </div>

        </div><!-- #mainPanel -->

        <div id="rightPanel">
          <div id="rightPanelHeader">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span id="selectedCount">선택된 트윗 (0개)</span>
              <button id="clearSelBtn" class="btn-danger" disabled>선택한 트윗 전체 해제</button>
            </div>

            <details id="sortBox">
              <summary>정렬 설정</summary>
              <div style="margin-top: 6px;">
                <div class="filterLabel">정렬기준</div>
                <div class="row" style="margin-top: 4px;">
                  <label class="pill"><input type="radio" name="sortField" value="date" checked /> 날짜</label>
                  <label class="pill"><input type="radio" name="sortField" value="rt" /> 리트윗수</label>
                  <label class="pill"><input type="radio" name="sortField" value="fav" /> 마음수</label>
                </div>
              </div>
              <div style="margin-top: 8px;">
                <div class="filterLabel">정렬순</div>
                <div class="row" style="margin-top: 4px;">
                  <label class="pill"><input type="radio" name="sortDir" value="desc" checked /> 내림차순</label>
                  <label class="pill"><input type="radio" name="sortDir" value="asc" /> 오름차순</label>
                </div>
              </div>
              <div class="row" style="margin-top: 6px;">
                <button id="sortApplyBtn" class="btn-primary">정렬 적용</button>
                <button id="threadGroupBtn" title="현재 순서를 유지하면서, 서로 이어지는 답글이 있다면 원트윗 아래에 순서대로 묶습니다">트윗타래 묶기</button>
              </div>
            </details>

            <input id="panelSearch" type="text" placeholder="ID 또는 키워드 검색" autocomplete="off" />
          </div>
          <div id="selectedList"></div>
        </div>

      </div><!-- #splitLayout -->
    </div><!-- #mainArea -->

    <!-- 하단 고정 바 (Full-width Bottom Bar) -->
    <div id="exportBottomBar" class="em-bottom-bar">
      <div class="em-bottom-bar-content">
        <div class="em-bb-left">
          <span class="em-bb-label">선택된 트윗</span>
          <span id="emToolbarCount" class="em-bb-count">0</span>
          <span class="em-bb-unit">개</span>
        </div>

        <div class="em-bb-center"></div>
        <div class="em-bb-right">
          <div class="export-tool-group">
            <div class="em-bb-formats">
              <label class="pill-btn"><input type="radio" name="exportFormat" value="text"
                  checked /><span>TXT</span></label>
              <label class="pill-btn"><input type="radio" name="exportFormat" value="json" /><span>JSON</span></label>
              <label class="pill-btn"><input type="radio" name="exportFormat"
                  value="tistory" /><span>티스토리(html)</span></label>
            </div>
            <button id="exportBtn" class="btn-primary btn-bottom-action" disabled>간단 내보내기</button>
          </div>
          <div class="export-tool-group">
            <div id="restoreDraftBtn" class="em-bb-restore-btn" style="display: none;">초안 이어하기</div>
            <button id="exportManagerBtn" class="btn-primary btn-bottom-action" disabled>내보내기 매니저</button>
          </div>
        </div>
      </div>
    </div>
  </div><!-- #appRoot -->

  <!-- 내보내기 매니저 모달 -->
  <div id="exportManagerOverlay" class="modal-overlay">
    <div id="exportManagerModal" class="modal-content">
      <div class="modal-header">
        <h3 id="emModalTitle" class="modal-title">내보내기 매니저 (1/3: 분할 모드)</h3>
        <button class="modal-close-btn" id="exportManagerCloseBtn">×</button>
      </div>
      <div class="info-box" id="emDescription">
        선택한 트윗 모음을 여러 개의 글로 나누어 내보낼 수 있습니다.<br>
        자동 분할을 이용하거나, 분할선을 마우스로 드래그해서 위치를 변경해 보세요.
      </div>
      <div class="modal-body">
        <div class="exportManagerLeft">

          <!-- Step 1 Left Controls -->
          <div id="emStep1Left">
            <div class="em-section-box">
              <div class="em-section-title">분할선 추가/제거</div>
              <div class="em-section-content">
                <button id="emAddDividerBtn" class="btn-primary w-100">+ 분할선
                  추가</button>
                <button id="emRemoveAllDividersBtn" class="btn-danger w-100">모든 분할선 제거</button>
              </div>
            </div>
            <div class="em-section-box">
              <div class="em-section-title">자동 분할 옵션</div>
              <div class="em-section-content">
                <div class="em-section-row">
                  <input type="number" id="emAutoSplitCount" value="50" min="1" class="em-section-input" />
                  <span>개 단위로 자르기</span>
                </div>

                <div class="em-section-row">
                  <label class="em-section-label">
                    <input type="checkbox" id="emAutoSplitIgnoreThread" />
                    <span>타래 무시하고 자르기</span>
                  </label>
                </div>

                <button id="emAutoSplitBtn" class="btn-primary w-100">자동 분할</button>
              </div>
            </div>
          </div>

          <!-- Step 2 Left Controls -->
          <div id="emStep2Left" style="display: none;">
            <div class="em-section-box mb-2">
              <div class="em-section-title">포맷 설정</div>
              <div class="em-section-content">
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emFormat" value="html" checked />
                    <span>HTML</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emFormat" value="markdown" />
                    <span>마크다운</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emFormat" value="pdf" />
                    <span>PDF (인쇄)</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emFormat" value="text" />
                    <span>텍스트 (TXT)</span></label>
                </div>

                <div class="em-section-divider"></div>

                <div class="em-section-row">
                  <label class="em-section-label">
                    <input type="checkbox" id="emIncMedia" checked />
                    <span>이미지 포함 내보내기</span>
                  </label>
                </div>
                <div class="em-section-row"
                  style="margin-top: 4px; padding-left: 24px; display: flex; align-items: center; gap: 8px; font-size: 12px; color: #666;">
                  <label style="display: flex; align-items: center; gap: 4px; cursor: pointer;">
                    <input type="checkbox" id="emImgResize" checked />
                    <span>크기 조절:</span>
                  </label>
                  <input type="number" id="emImgMaxWidth" value="400" step="50" min="100" max="1200"
                    style="width: 50px; padding: 2px 4px; border: 1px solid #ccc; border-radius: 3px;" />
                  <span>px</span>
                </div>
              </div>
            </div>

            <div class="em-section-box mb-2 collapsed">
              <div class="em-section-title">포함할 데이터</div>
              <div class="em-section-content">
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncIntro" /> <span>게시글
                      인트로</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncUserId" checked /> <span>트위터
                      아이디</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncDate" checked /> <span>작성
                      날짜</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncTime" checked /> <span>작성
                      시간</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncRt" checked /> <span>리트윗
                      수</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncFav" checked /> <span>마음에 들어요
                      수</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="checkbox" id="emIncLink" checked /> <span>트윗 원본
                      링크</span></label>
                </div>
              </div>
            </div>

            <div class="em-section-box mb-2 collapsed" id="emHtmlStyleBox">
              <div class="em-section-title">스타일 선택</div>
              <div class="em-section-content">
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emStylePreset" value="styleA" checked />
                    <span>스타일A (컬러 아이콘)</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emStylePreset" value="styleB" />
                    <span>스타일B (회색 아이콘)</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emStylePreset" value="styleC" />
                    <span>스타일C (이모지 텍스트)</span></label>
                </div>
              </div>
            </div>

            <div class="em-section-box mb-2 collapsed" id="emMdStyleBox" style="display: none;">
              <div class="em-section-title">스타일 선택</div>
              <div class="em-section-content">
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emMdStylePreset" value="styleA" checked />
                    <span>스타일A (한글)</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emMdStylePreset" value="styleB" />
                    <span>스타일B (영문)</span></label>
                </div>
                <div class="em-section-row">
                  <label class="em-section-label"><input type="radio" name="emMdStylePreset" value="styleC" />
                    <span>스타일C (이모지)</span></label>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 3 Left Controls -->
          <div id="emStep3Left" style="display: none;">
            <div class="em-section-box mb-2">
              <div class="em-section-title">적용된 설정</div>
              <div class="em-section-content">
                <div style="font-size: 13px; color: #555; line-height: 1.5;">
                  <div>포맷: <span id="emStep3FormatText"></span></div>
                  <div>데이터: <span id="emStep3DataText"></span></div>
                </div>
              </div>
            </div>
          </div>

          <div class="exportManagerStepTitle" id="emChunkListTitle" style="margin-top: 16px;">리스트</div>
          <div id="emChunkList">
            <!-- 청크 버튼들이 들어갈 자리 -->
          </div>

        </div>
        <div class="exportManagerRight">

          <!-- Step 1 Right Viewer -->
          <div id="emStep1Right" style="height: 100%; display: flex; flex-direction: column;">
            <div class="exportManagerStepTitle">분할 미리보기 (읽기 전용)</div>
            <div id="emViewer">
              <!-- selectedList 와 동일한 형태의 트윗 뷰 및 분할선 블록 -->
            </div>
          </div>

          <!-- Step 2 Right Viewer -->
          <div id="emStep2Right" style="height: 100%; display: none; flex-direction: column;">
            <div class="exportManagerStepTitle">최종 결과물 미리보기</div>
            <div id="emPreviewViewer"
              style="flex: 1; overflow-y: auto; background: #fff; border: 1px solid #ccc; padding: 15px;">
              <!-- 미리보기 결과가 렌더링될 영역 -->
            </div>
          </div>

          <!-- Step 3 Right Viewer -->
          <div id="emStep3Right" style="height: 100%; display: none; flex-direction: column;">
            <div class="exportManagerStepTitle">내보내기 진행 상태</div>

            <div id="emExportSimpleBox" style="display: none; flex: 1; flex-direction: column;">
              <textarea id="emExportSimpleTextarea" readonly
                style="flex:1; width: 100%; resize: none; border: 1px solid #ccc; padding: 12px; font-family: monospace; font-size: 13px;"></textarea>
              <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 10px;">
                <button id="emExportSimpleCopyBtn" class="btn-primary">클립보드에 복사</button>
                <button id="emExportSimpleSaveBtn" class="btn-primary">텍스트 파일로 저장</button>
              </div>
            </div>

            <div id="emExportAdvancedBox" style="display: none; flex: 1; flex-direction: column;">
              <div style="flex: 1; overflow-y: auto; background: #fff; border: 1px solid #ccc; padding: 15px;"
                id="emExportAdvancedContainer">
                <section>
                  <div class="advExportStep">① 이미지 업로드 스크립트 실행</div>
                  <p>이 스크립트를 다운로드해 실행하면 현재 청크의 이미지만 임시 폴더로 자동 모아줍니다.<br>스크립트 실행 후, 임시 폴더 안의 파일들을 빈 티스토리 에디터에 모두
                    업로드하세요.
                  </p>
                  <div class="advExportImageList" id="emExportAdvImageList"></div>
                  <div style="margin-top: 8px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                    <button id="emExportAdvScriptBtn">스크립트 다운로드 (.ps1)</button>
                  </div>
                </section>
                <section style="margin-top: 20px;">
                  <div class="advExportStep">② 치환자 붙여넣기</div>
                  <p>에디터 우측의 메뉴에서 기본 모드>마크다운/HTML 모드로 전환 후, 티스토리가 생성한 본문 태그 전체를 여기에 붙여넣으세요.</p>
                  <textarea id="emExportAdvPasteArea" rows="4"
                    style="width: 100%; box-sizing: border-box; font-size: 11px; font-family: monospace; resize: vertical; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px;"
                    placeholder='[##_Image|kage@.../img.jpg?...|CDM|1.3|{"filename":"파일명.jpg",...}_##]'></textarea>
                  <div class="advExportMatchStatus" id="emExportAdvMatchStatus"></div>
                </section>
              </div>
              <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 10px;">
                <button id="emExportAdvCopyBtn" class="btn-primary" disabled>내보내기 (최종 HTML 복사)</button>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div class="modal-footer">
        <button id="emPrevBtn" class="btn-gray" style="display: none;">← 이전 단계 (분할
          모드)</button>
        <div style="flex: 1;"></div>
        <button id="emNextBtn" class="btn-primary">다음 단계 (포맷 설정) →</button>
      </div>
    </div>
  </div>

  <script src="./src/marked.min.js"></script>
  <script src="./src/utils.js"></script>
  <script src="./src/tweetClassifier.js"></script>
  <script src="./src/fsLoader.js"></script>
  <script src="./src/ui.js"></script>
  <script src="./src/selectedPanel.js"></script>
  <script src="./src/tistoryExport.js"></script>
  <script src="./src/app.js"></script>
  <script src="./src/exportAdvanced.js"></script>
  <script src="./src/export/emViewer.js"></script>
  <script src="./src/export/emChunkNav.js"></script>
  <script src="./src/export/emStep3.js"></script>
  <script src="./src/exportManager.js"></script>
  <script src="./src/export/emDraft.js"></script>
  <script src="./src/htmlConverter.js"></script>
  <script src="./src/layout.js"></script>
</body>

<!-- HTML 변환기 (개인용 도구, 필요 시 display: block으로 변경하여 사용) -->
<div id="htmlConverterSection"
  style="display: none; position: fixed; bottom: 80px; right: 20px; z-index: 9999; background: white; border: 2px solid #333; padding: 15px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); width: 400px;">
  <h3 style="margin-top: 0; font-size: 16px;">HTML 변환기 (Blog -> Style A)</h3>
  <textarea id="converterInput"
    style="width: 100%; height: 150px; margin-bottom: 10px; font-family: monospace; font-size: 12px;"
    placeholder="여기에 이전 HTML을 붙여넣으세요..."></textarea>
  <button id="convertBtn" class="btn-primary" style="width: 100%;">변환 및 클립보드 복사</button>
</div>

</html>